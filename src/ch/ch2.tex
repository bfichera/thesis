\section{Space groups, point groups, and Neumann's principle}

The utility of \gls{shg} in studying condensed matter systems is derived from the following simple statement, attributed to Franz Neumann\cite{neumann_vorlesungen_1885} and later Pierre Curie\cite{curie_sur_1894}:

\begin{theorem}[Neumann's principle]\label{thm:neumann}
Let $P_G$ be the symmetry group of a crystal structure and $P_H$ the symmetry group of some physical property of that crystal.
Then, $P_G$ is a subgroup of $P_H$.
\end{theorem}

There are a few things to digest here.
Let us start by understanding the meaning of the phrase ``symmetry group''.
For any given crystal, there exists some infinitely large set of operations $G$ under which the crystal structure is symmetric.
Each of these operations may be decomposed into two parts: a ``point-preserving operation'' $R$, corresponding to either the identity, rotation, inversion, mirror, or the product of mirror and rotation, followed by a translation by some vector $\bm{\tau}$:

\begin{equation}\label{eq:spacegroup}
G = \{(R|\bm{\tau})\}
\end{equation}

where $(R|\bm{\tau})$ means ``Perform $R$, then translate by $\bm{\tau}$''.
Clearly, the set $G$ forms a group, since if both $g_1$ and $g_2 \in G$ leave the crystal structure invariant, so does the product $g_1g_2$, and so $g_1g_2 \in G$.
Thus, $G$ is called the \emph{space group} of the crystal.
In three dimensions, there are $230$ crystallographic space groups, which are tabulated in a number of places, most usefully Wikipedia\cite{wiki:spacegroups}.

For $73$ of these groups, the translation parts of the $\bm{\tau}$'s in \cref{eq:spacegroup} are only ever linear combinations of integer multiples of the lattice vectors $\bm{a}$, $\bm{b}$, and $\bm{c}$; these are called \emph{symmorphic} space groups.
The remaining $157$ groups involve translations that are not integer multiples of the lattice vectors; these are one's screw axes and glide planes, and so these groups are called \emph{asymmorphic}.

Importantly, the ``physical properties'' of \cref{thm:neumann} refer to the truly macroscopic properties of the crystal, like its conductivity, dielectric, or pyroelectric tensors.
Consider, for example, that in \gls{shg}, we are typically studying the sample at optical wavelengths, where the wavelength of light is three or four orders of magnitude larger than the lattice spacing.
Clearly, then, these properties do not care whether the correct symmetry is $(R|\bm{\tau})$ or $(R|\bm{\tau}+\nicefrac{\bm{a}}{2})$.
A more useful group, then, is the \emph{point group} of the crystal

\begin{equation}
P_G = \{R~\suchthat~\exists~\bm{\tau}~\suchthat~(R|\bm{\tau})~\in~G\}
\end{equation}

i.e., the point group is the set of point-preserving operations $R$ for which $R$ appears in $G$, regardless of whether you need to perform a translation with it.
Once can show that $P_G$ is also a group, and thus it is $P_G$ which is involved in Neumann's principle for all intents and purposes\footnote{Of course this breaks down when the wavelength of light is comparable to the lattice spacing; in that case you need to consider the full space group.}.

The last ingredient that we need to understand \cref{thm:neumann} is the concept of what is meant by ``physical propery''.
The idea is that the response of the crystal $J_{i_1i_2\cdots i_n}$ (i.e., the current $J_i$, or the quadrupole moment $Q_{ij}$) is proportional to some field $F_{i_1'i_2'\cdots \i_m'}$ via some tensor $\chi$:
\begin{equation}
J_{i_1i_2\cdots i_n} = \chi_{i_1i_2\cdots i_n i_1' i_2'\cdots i_m'}F_{i_1' i_2' \cdots \i_m'}.
\end{equation}
For example, the conductivity $\sigma_{ij}$ relates a current density $J_i$ to an applied electric field $E_j$:
\begin{equation}
J_i = \sigma_{ij} E_j.
\end{equation}
Likewise, the polarization $P_i$ due to the pyroelectric effect is related to the a temperature difference $\Delta T$ by a tensor $p_i$:
\begin{equation}
P_i = p_i \Delta T.
\end{equation}
The tensors $\sigma_{ij}$, $p_i$, and generally, $\chi_{i_1 i_2 \cdots \i_n i_1' i_2' \cdots i_m'}$ are commonly referred to as \emph{matter tensors}\cite{powell}, to emphasize the fact that they are the only part of the response equations that depend on the material.
It should be noted that matter tensors generically come in two types: those that transform like a vector under inversion and those that transform like a pseudovector under inversion.
You can tell which is which by applying inversion to either side of the response equation.
For example, the tensor $\epsilon_{ij}$ relating the displacement field to the electric field
\begin{equation}
D_i = \epsilon_{ij}E_j
\end{equation} 
is a polar tensor, whereas the tensor $\chi^{me}_{ij}$ describing the magnetoelectric effect
\begin{equation}
M_i = \chi^{me}_{ij} E_j
\end{equation}
is an axial tensor.

We are now ready to restate \cref{thm:neumann} in a slightly more useful form, using the terminology we have developed about point groups and matter tensors:
\begin{theorem}[Neumann's principle, restated]\label{thm:neumannrestated}
Let $P_G$ be the point group of a given crystal, and let $\chi$ be a matter tensor describing some response function of that crystal.
Then, for all $g \in P_G$, we have
\begin{equation}\label{eq:nmmath}
g(\chi) = \chi.
\end{equation}
\end{theorem}

\Cref{eq:nmmath} can be more usefully expressed if we know the matrix $R^g_{ij}$ corresponding to $g$.
For example, if $g$ is ``threefold rotation about the $z$ axis'', we have
\begin{equation}
R^g_{ij} = \left(\begin{matrix}
-\frac{1}{2} & -\frac{\sqrt{3}}{2} & \phantom{-}0\phantom{-} \\
\phantom{-}\frac{\sqrt{3}}{2} & -\frac{1}{2} & \phantom{-}0\phantom{-} \\
\phantom{-}0 & \phantom{-}0 & \phantom{-}1\phantom{-}
\end{matrix}\right),
\end{equation}
in which case one can show that \cref{eq:nmmath} reads
\begin{equation}\label{eq:nmindex}
(\det{R^g})^tR^g_{i_1i_1'}R^g_{i_2i_2'}\cdots R^g_{i_ni_n'}\chi_{i_1'i_2'\cdots i_n'} = \chi_{i_1i_2\cdots i_n},
\end{equation}
where $t$ is $0$ if $\chi$ is a polar tensor and $1$ if $\chi$ is an axial tensor.
\Cref{thm:neumannrestated} tells us that there is one copy of \cref{eq:nmindex} for each $g \in P_G$. 

Apparently, each element $g \in P_G$ gives us a \emph{constraint} on the numbers $\chi_{i_1i_2\cdots i_n}$, in that they have to satisfy \cref{eq:nmindex}. 
This is a remarkably useful fact.
Since different point groups enforce different constraints on $\chi$, that means the \emph{form} of $\chi$ (e.g. when written as a list of numbers) depends quite sensitively on the point group of the crystal we are studying.
As an example, here is the dielectric permittivity tensor for crystals with the point group (in Schoenflies notation) $C_2$:
\begin{equation}
\epsilon_{ij} = \left(\begin{matrix}
a & 0 & e \\
0 & b & 0 \\
e & 0 & c
\end{matrix}\right)_{ij}
\end{equation}
versus in the point group $D_{3d}$:
\begin{equation}
\epsilon_{ij} = \left(\begin{matrix}
a & 0 & 0 \\
0 & a & 0 \\
0 & 0 & c
\end{matrix}\right)_{ij}.
\end{equation}
Clearly, any \emph{measurement} of $\epsilon_{ij}$ will be able to easily differentiate a crystal with point group $C_2$ from one with point group $D_{3d}$.
This is the fundamental basis, then, for \gls{shg}.
In \gls{shg}, we measure the tensor $\chi_{ijk}$ corresponding to the response equation\footnote{This discussion is a bit simplified in the sense that there are actually \emph{many} response functions which will give you light at $2\omega$; for a more detailed discussion, see \cref{sec:manyshgterms}.}
\begin{equation}\label{eq:shgsimple}
P_i(2\omega) = \chi_{ijk}E_j(\omega)E_k(\omega);
\end{equation}
the numbers $\chi_{ijk}$ thus tell us about the crystallographic point group we are measuring from.

There are a couple of advantages to measuring $\chi_{ijk}$ over any other matter tensor in a given system.
For one thing, $\chi_{ijk}$ is a third rank tensor, which means it has a few more degrees of freedom to work with compared to $\epsilon_{ij}$, and thus does a better job at uniquely specifying each point group.
It also doesn't have \emph{too many} degrees of freedom, so that most of the time your experiment will be able to tell you all of your tensor elements\footnote{Quadrupole \gls{shg} has this problem, see \cref{sec:manyshgterms}.}.
In addition, since we are typically doing \gls{shg} at optical wavelengths, the form of $\chi_{ijk}$ reflects the symmetry of the \emph{charge distribution} $\rho(\bm{x})$, in contrast to e.g. x-ray diffraction, where the relevant tensors will tell instead you about the electron distribution, $n(\bm{x})$.
This can be advantageous in cases where the long range order you are trying to study involves an ordering of the valence electrons but not the electrons in the cores of atoms.
This is entirely the result of the fact that Neumann's principle, as expressed both in \cref{thm:neumann} and \cref{thm:neumannrestated}, tells us that the point group of our crystal is a \emph{subgroup} of the point group we get from our measurement -- the measurement can always be more symmetric than the crystal!

As another example of this fact, let us note that the response equation given by \cref{eq:shgsimple} clearly has an additional symmetry $j \leftrightarrow k$, since the two copies of the electric field on the right hand side are equivalent.
Obviously this is not a result of the material we are studying, it is simply a fact of doing \gls{shg}.
Thus, in addition to the constraints given by Neumann's principle and \cref{eq:nmindex}, we have the additional constraint
\begin{equation}
\chi_{ijk} = \chi_{ikj} \forall i,j,k.
\end{equation}
This is known as \emph{particularization}\cite{birss}.

\section{A classical understanding of \gls{shg}}

In the last section we considered the \gls{shg} response function given by \cref{eq:shgsimple}.
Where does this relationship come from, and how is $P(2\omega)$ eventually measured?
Our starting point in the classical treatment will be the inhomogenous electromagnetic wave equation
\begin{equation}\label{eq:maxwell}
\left(\nabla^2 - \frac{1}{c^2}\frac{\partial^2}{\partial t^2}\right) E_i(\bm{x}, t) = S_i(\bm{x}, t),
\end{equation}
which we understand as defining the field $E_i(\bm{x}, t)$ radiated by the source term $S_i(\bm{x}, t)$, which is induced by the incident field.
To lowest order in a multipole expansion, $S_i(\bm{x}, t)$ is given by\cite{jackson,kumar}
\begin{equation}
\mu_0 \frac{\partial^2 P_i(\bm{x}, t)}{\partial t^2} + \mu_0\left(\epsilon_{ijk}\nabla_j \frac{\partial M_k(\bm{x}, t)}{\partial t}\right) -\mu_0\left(\nabla_j \frac{\partial^2 Q_{ij}(\bm{x}, t)}{\partial t^2}\right)
\end{equation}
where $P_i(\bm{x}, t)$, $M_i(\bm{x}, t)$, and $Q_{ij}(\bm{x}, t)$ are the induced electric dipole, magnetic dipole, and electric quadrupole densities, and $\epsilon_{ijk}$ is the Levi-Civita tensor.

If the incident electric field is small, then the terms $P_i(\bm{x}, t)$, $M_i(\bm{x}, t)$, and $Q_{ij}(\bm{x}, t)$ are linear functions of that electric field.
However, for larger incident fields (such as those generated by pulsed lasers), they may be more generally written as a taylor series:
\begin{align}
P_i &= \chi^{ee}_{ij} E_j+\chi^{em}_{ij} H_j+\chi^{eee}_{ijk} E_j E_k+\chi^{eem}_{ijk} E_j H_k+\cdots\label{eq:plong}\\
M_i &= \chi^{me}_{ij} E_j+\chi^{mm}_{ij} H_j+\chi^{mee}_{ijk} E_j E_k+\chi^{mem}_{ijk} E_j H_k+\cdots\label{eq:mlong}\\
Q_{ij} &= \chi^{qe}_{ijk} E_k+\chi^{qm}_{ijk} H_k+\chi^{qee}_{ijkl} E_k E_l+\chi^{qem}_{ijkl} E_k H_l+\cdots\label{eq:qlong}
\end{align}
where we have suppressed the arguments $\bm{x}$ and $t$ for brevity.

Assuming the incident field is monochromatic,
\begin{align}
E_i(\bm{x}, t) &= E_i(\omega) e^{i(\bm{k}\cdot \bm{x} -\omega t)}+\mathrm{c.c.}\\
H_i(\bm{x}, t) &= H_i(\omega) e^{i(\bm{k}\cdot \bm{x} -\omega t)}+\mathrm{c.c.}
\end{align}
the induced sources are also monochromatic, and (keeping only terms proportional to $e^{i2\omega t}$) we thus get 
\begin{align}
P_i(2\omega) &= \chi_{ijk}^{eee}E_j(\omega)E_k(\omega)+\chi_{ijk}^{eem}E_j(\omega)H_k(\omega)\label{eq:pshort}\\
M_i(2\omega) &= \chi_{ijk}^{mee}E_j(\omega)E_k(\omega)+\chi_{ijk}^{mem}E_j(\omega)H_k(\omega)\label{eq:mshort}\\
Q_{ij}(2\omega) &= \chi_{ijkl}^{qee}E_k(\omega)E_l(\omega)+\chi_{ijkl}^{qem}E_k(\omega)H_l(\omega)\label{eq:qshort}.
\end{align}

Since \cref{eq:maxwell} is linear, the electric field radiated by $S_i(\bm{x}, t)$ is simply proportional to it.
In the limit where the first term of \cref{eq:pshort} dominates, the intensity measured at our detector thus satisfies
\begin{equation}
I(2\omega) \propto |\hat{e}^\mathrm{out}_i \chi^{eee}_{ijk} \hat{e}^\mathrm{in}_j \hat{e}^\mathrm{in}_k|^2,
\end{equation}
where $\hat{\bm{e}}^\mathrm{in}$ and $\hat{\bm{e}}^\mathrm{out}$ are unit vectors in the direction of the incoming and measured electric fields\footnote{Usually there are polarizers in the experiment which define these directions.}.
$\chi^{eee}_{ijk}$ does typically dominate when inversion symmetry is broken, but if not, you have to consider all of the terms in \crefrange{eq:pshort}{eq:qshort}.
Actually, each of these terms needs to be considered twice, since there is both a surface contribution and a bulk contribution\footnote{The space group which constrains the surface contributions is the bulk space group less the operations which involve some change in the $z$ coordinate.}.
In my experience, the heirarchy of contributions (from most to least important, and assuming everything is allowed by symmetry) is typically:
\begin{enumerate}
\item\label{item:contribution1} Bulk electric dipole
\item\label{item:contribution2} Surface electric dipole, bulk electric quadrupole, and bulk magnetic dipole, at the same order\footnote{Somehow the bulk electric quadrupole and magnetic dipole contributions have been labelled ``exotic'' by some in the community, but that has not been my experience. If I had to guess, almost half of the materials I have measured with inversion symmetry show electric quadrupole \gls{shg}.}
\item Everything else
\end{enumerate}
I've never seen anything outside of \cref{item:contribution1,item:contribution2}, but in rare cases an electronic resonance may cause an enhancement in one of the other contributions\cite{fiebig_second_2001}.

Let us take a moment now to emphasize the following extremely common misconception about \gls{shg}: just because you see \gls{shg} in your experiment, that does not mean that inversion symmetry is broken in your material!
It also does not mean that your material is a ferroelectric, or really that there's anything special at all about your material, at least before you've done any further analysis.
Similarly, if you \emph{don't} see \gls{shg}, that doesn't mean inversion symmetry is preserved, either.
I have repeatedly seen large electric quadrupole \gls{shg} show up in materials with inversion symmetry, while materials which definitely break inversion symmetry have absolutely zero \gls{shg} observable in the experiment.
The reason for this is ultimately due to resonance, a topic which I will discuss in \cref{sec:resonance}, but I mention it here because it is truly quite common in the literature and it is surely a mistake worth avoiding.
You are ``allowed'' to say your material breaks inversion symmetry only if there is no other contribution in \crefrange{eq:pshort}{eq:qshort} which fits your data, and you are basically never allowed to say that your material preserves inversion symmetry when there is no \gls{shg} (a fact that should be obvious on a careful reading of \cref{thm:neumann}).

\section{\Gls{shg} in quantum mechanics}

The description of \gls{shg} in the previous section is probably the most useful for understanding \gls{shg} from an ``optics'' perspective, but it gives little insight into the true microscopic origin of the \gls{shg} intensity.
The quantum description, on the other hand, will tell you exactly where the \gls{shg} is coming from microscopically, but only if you have access to the eigenfunctions $\ket{\psi}$ of your hamiltonian -- it is of little use otherwise.
Nevertheless, we can still gain intuition about the dependence of our \gls{shg} intensity on the frequency of the light in the quantum picture, which will be useful for clearing up a whole other slew of misconceptions that have somehow made their way into the \gls{shg} literature.
This treatment closely follows that of \onlinecref{boyd}.

The starting point is to describe the system under study as a statistical ensemble specified by a Hamiltonian
\begin{equation}
H = H_0+\lambda V
\end{equation}
and a density matrix
\begin{equation}
\rho(t) = \sum_i p_i(t) \ket{\psi_i(t)}\bra{\psi_i(t)}
\end{equation}
where the $p_i(t)$'s specify the classical probability of the system being in state $i$ at time $t$, and the $\ket{\psi_i}$'s are wavefunctions given by
\begin{equation}
\ket{\psi_i(t)} = \sum_n c_n^i(t) \ket{n}
\end{equation}
for some $\{c_n^i(t)\}$, where
\begin{equation}
H_0\ket{n} = E_n \ket{n}
\end{equation}
for all $n$.
In the presence of damping, the elements
\begin{equation}
\rho_{nm} = \bra{\psi_n}\rho\ket{\psi_m}
\end{equation}
of $\rho$ satisfy the differential equation
\begin{equation}\label{eq:rhodot}
\dot{\rho_{nm}} = \frac{1}{i\hbar}[H, \rho]_{nm}-\gamma_{nm}(\rho_{nm}-\rho_{nm}^\mathrm{(eq)}),
\end{equation}
where $\gamma_{nm}$ is a matrix of (phenomenological) damping parameters\footnote{This is just one choice of $p_i(t)$.}, and $\rho_{nm}^\mathrm{(eq)}$ is the density matrix corresponding to the equilibrium steady state of the system.

We consider the case where $V$ may be treated as a perturbation on top of $H_0$, i.e. where $\lambda$ is small.
In this case, \cref{eq:rhodot} can be written
\begin{equation}
\dot{\rho}_{nm} = -i \omega_{nm} \rho_{nm}+\frac{1}{i\hbar}\sum_k \lambda(V_{nk}\rho_{km}-\rho_{nk}V_{km})-\gamma_{nm}(\rho_{nm}-\rho_{nm}^\mathrm{(eq)}),
\end{equation}
where $\omega_{nm}=E_{nm}/\hbar$, and we seek a solution
\begin{equation}
\rho_{nm}=\rho_{nm}^{(0)}+\lambda\rho_{nm}^{(1)}+\lambda^2\rho_{nm}^{(2)}+\cdots.
\end{equation}
Turning the crank (see \onlinecref{boyd} for details) gives us the solution
\begin{equation}
\rho_{nm}^{(N)}(t) = \int_{-\infty}^t \frac{1}{i\hbar}[\lambda V(t'), \rho^{(N-1)}(t')]_{nm}e^{(i\omega_{nm}+\gamma_{nm})(t'-t)} \, dt'.
\end{equation}
Carrying out this series to second order in $\lambda$ with the perturbation $V(t)=-\bm{\mu}\cdot\bm{E}(t)$, where $\bm{\mu}$ is the dipole moment and $\bm{E}(t) = \sum_q\bm{E}(\omega_q)e^{-i\omega_q t}$ is the incident electric field, we get an expression for the density matrix $\rho_{nm}^{(2)}(t)$ as a function of the dipole matrix elements
\begin{equation}
\bm{\mu}_{nm} = \bra{n}\bm{\mu}\ket{m},
\end{equation}
the frequencies $\omega_q$, the damping constants $\gamma_{nm}$, and $\rho_{nm}^{(0)}$.

Once we have $\rho_{nm}^{(2)}(t)$, we can compute the expectation value
\begin{equation}
\left<\bm{\mu}(t)\right>=\sum_{nm}\rho_{nm}(t)\bm{\mu}_{nm},
\end{equation}
from which the susceptibility can be computed by taking two derivatives with respect to the electric field amplitudes\footnote{We are specializing here to the case of electric dipole \gls{shg}, although the calculation proceeds similarly for magnetic dipole and electric quadrupole.}.
Reproducing the final answer here (again, from \onlinecref{boyd}):
\begin{equation}\label{eq:bigshg}
\begin{aligned}
\chi_{ijk}^{(2)}(\omega_p+&\omega_q, \omega_q, \omega_p) = \frac{1}{2\epsilon_0\hbar^2}\sum_{lmn}(\rho_{ll}^{(0)}-\rho_{mm}^{(0)})\times\Big\{\\
&\frac{\mu^i_{ln}\mu^j_{nm}\mu^k_{ml}}{[(\omega_{nl}-\omega_p-\omega_q)-i\gamma_{nl}][(\omega_{ml}-\omega_p)-i\gamma_{ml}]}\\
+&\frac{\mu^i_{ln}\mu^k_{nm}\mu^j_{ml}}{[(\omega_{nl}-\omega_p-\omega_q)-i\gamma_{nl}][(\omega_{ml}-\omega_q)-i\gamma_{ml}]}\\
+&\frac{\mu^j_{ln}\mu^i_{nm}\mu^k_{ml}}{[(\omega_{nm}+\omega_p+\omega_q)+i\gamma_{nm}][(\omega_{ml}-\omega_p)-i\gamma_{ml}]}\\
+&\frac{\mu^k_{ln}\mu^i_{nm}\mu^j_{ml}}{[(\omega_{nm}+\omega_p+\omega_q)+i\gamma_{nm}][(\omega_{ml}-\omega_q)-i\gamma_{ml}]}\\
\Big\},
\end{aligned}
\end{equation}
where $\omega_{nm}=\omega_n-\omega_m$.
The \gls{shg} susceptibility tensor is then obtained by taking the limit $\omega_p=\omega_q$.

We learned two things by doing the quantum calculation.
First of all, clearly if we know all of the eigenfunctions $\ket{n}$ of our unperturbed Hamiltonian, we can calculate the susceptibility tensor \textit{a priori}, although this is obviously difficult except in the simplest of cases.
Secondly, we notice that there are two types of denominators in \cref{eq:bigshg}: those occuring at $2\omega$ (remember we have set $\omega_q=\omega_p$) and those occuring at $\omega$.
Both can cause resonances in the \gls{shg} intensity and are observed abundantly in experiment\cite{fiebig_second_2001}.
The existence of resonances in the \gls{shg} spectrum makes comparison between different materials quite difficult if reference is made only to the \gls{shg} intensity at a single color.
In one imfamous example, Wu \etal (\onlinecref{wu_giant_2016}) incorrectly attributed the large \gls{shg} amplitude at optical wavelengths in \ce{TaAs} to the presence of Weyl nodes near the Fermi level; later \gls{shg} spectroscopy measurements demonstrated that the enhancement was due to a simple band resonance at the excitation frequency used in that paper\cite{patankar_resonance-enhanced_2018}.
The emerging consensus is that the \gls{shg} intensity at optical frequencies has more or less nothing to do with the low-energy excitation spectrum or its topology.
