\section{Description of the setup}\label{sec:setupdescription}

In the last chapter we saw that the \gls{shg} intensity in a given crystal is related to the point group, order parameter, band structure, etc. of that crystal via the susceptibility tensor $\chi_{ijk}$.
It is also obvious from \cref{sec:neumann} that the ideal scenario is to be able to measure as many of the numbers $\chi_{ijk}$ as possible; after all, if you only measured the $xx$ component of \cref{eq:c2eps,eq:d3deps}, you would have obtained essentially no information about your crystal whatsoever.
The \gls{shg} setup that we built (whose design is mostly credited to Torchinsky and Hsieh\citep{torchinsky_low_2014}, with some improvements by us which I will discuss below) was designed with exactly this goal in mind.
There are two key insights which make this design work: one, the light is obliquely incident on the sample so there is some component of $\bm{E}^\mathrm{in}$ directed along the sample normal, and two, we rotate the plane of incidence so that the in-plane field direction sweeps an entire $360^\circ$.
The first point allows us to measure elements of $\chi_{ijk}$ with $z$ indices\footnote{Here and unless otherwise noted I define the sample normal to be the $z$ axis.}, and the second point makes sure we get all of the $x$ and $y$ elements of $\chi_{ijk}$ too.
All of the tensor elements are thus given a chance to contribute to the \gls{shg} intensity in a given experiment.

With those considerations in mind, let me proceed to give a schematic description of our \gls{shg} setup.
Some of the choices we made may seem arbitrary right now, but I will go over them in detail in \cref{sec:beforeyoubuild}.
The starting point is our regenerative amplifier (Spectra-Physics Spitfire Sptf-100f-5k-xp), which produces $100$ \si{fs} $800$ \si{nm} pulses at a $5$ \si{kHz} repetition rate from an $86$ \si{MHz} seed laser (Spectra-Physics Tsunami 3941-M1S). 
$90\%$ of the beam is split off to power an \gls{opa}, and the remaining $10\%$ is used for the \gls{shg} probe beam.
After passing through an optical telescope, which creates a collimated beam of width $1-2$ \si{mm}, this beam is attenuated with a polarizer - half-wave plate - polarizer triplet, and then elliptically polarized with a quarter-wave plate and half-wave plate in series.
The ellipticity at this stage is set so the light is perfectly circularly polarized following transmission through a phase mask, as described below.

After passing through these polarization optics, the beam is focused with a lens onto the aforementioned phase mask, which acts as a transmissive diffraction grating and separates the beam into multiple different diffraction orders.
The $+1$ order diffraction comes off at an angle of roughly $7^\circ$, while the other orders are blocked with anodized aluminum foil. 
This (diverging) beam then propogates at $7^\circ$ to the optical axis before meeting a lens set at the appropriate distance so as to both collimate the beam and rectify the $7^\circ$ progation angle.
Then, the light passes through a dichroic mirror (which transmits $800$ \si{nm} and reflects $400$ \si{nm}), becomes linearly polarized by a wire-grid polarizer, and is then focused onto the sample at a $10^\circ$ angle of incidence by passing through the edge of a $1$ \si{in}-diameter $50$ \si{mm} achromatic focusing lens.
The interaction between the light and the sample causes \gls{shg} to be radiated in reflection at the same $10^\circ$ angle of incidence, so that the \gls{shg} beam passes through the opposite side of the $50$ \si{mm} lens before passing through a second, independent polarizer which is used to control the polarization of the measured light.

\begin{figure}
\includegraphics[width=\textwidth]{gfx/ch3/pdf/setup.pdf}
\caption{\label{fig:setup}Schematic drawing of the \gls{shg} setup used in this research. After \citet{morey_automated_2024}.}
\end{figure}

Finally, the polarized output reflects off of two dichroic mirrors (oriented in such a way as to cancel the differing effect of the Fresnel equations on the reflectivity of S and P polarized light) and is focused through a $400$ \si{nm} bandpass filter onto a \gls{pmt} by a $400$ \si{mm} lens.
The current output of the \gls{pmt} is filtered by a lock-in amplifier (for static \gls{shg}, set to the $5$ \si{kHz} repetition rate of the laser) and read out on an oscilloscope.
The phase mask, incoming polarizer, and outgoing polarizer are mounted on rotating lens tubes which are connected via pulley to a common motor shaft driven at $\sim 5$ \si{Hz} by a brushless DC motor.
The motor thus continuously rotates the plane of incidence of the experiment, since the latter is entirely defined by the phase mask and the polarizers.
The rotation angle is tracked as a function of time by an optical rotary encoder, consisting of a laser pointer passed through a chopper wheel (with 100 slots) mounted at the end of the motor shaft and detected via photodiode.
The encoder signal and the lock-in signal are both sent to a homemade oscilloscope (an Arduino Uno microcontroller which separates the lock-in signal into different individual rotations by looking for peaks in the encoder signal), the output of which is sent to a computer for further data processing.

\section{Before you build}\label{sec:beforeyoubuild}

I list here a few essential aspects of \gls{shg} that should be considered before designing a new setup.

\subsection{Spot size}

One of the most important quantities in an \gls{shg} setup is the diameter of the probe spot.
Ideally, this diameter is as small as possible, so as to measure the smallest samples or domain sizes.
However, there is an important caveat: for constant fluence (i.e. supposing we are limited by the sample damage threshold), the \gls{shg} signal to noise ratio scales linearly in the area excited by the probe, and thus \gls{shg} microscopes have a difficult time measuring small \gls{shg} signals compared to traditional \gls{shg} setups with a larger excitation area.
To see this, let us say that our detector measures the number of photons per \gls{shg} pulse, which is proportional to the pulse energy $U_p(2\omega)$.
Assuming the input and output pulse intensity profiles have the shape of a square wave with width $\tau$ and height $I_p(\omega)$ and $I_p(2\omega)$, respectively, we have
\begin{equation}
U_p(2\omega) = A I_p(2\omega) \tau
\end{equation}
and
\begin{equation}
U_p(\omega) = A I_p(\omega) \tau
\end{equation}
where $A$ is the area of the beam at the sample surface.
The \gls{shg} intensity is proportional to the square of the input intensity
\begin{equation}
I_p(2\omega) \propto I_p^2(\omega)
\end{equation}
so that
\begin{equation}
U_p(2\omega) \propto \frac{U_p^2(\omega)}{A\tau}.
\end{equation}
Substituting for the fluence $f$
\begin{equation}
f(\omega) = \frac{U_p(\omega)}{A}
\end{equation}
we have
\begin{equation}
U_p(2\omega) \propto \frac{f^2(\omega)A}{\tau}
\end{equation}
i.e., if we hold the fluence constant at the sample damage threshold, the number of photons in the generated \gls{shg} pulse is proportional to the excitation area and inverse to the pulse width.
The signal to noise ratio is then given by
\begin{equation}
\mathrm{SNR} \propto \frac{U_p(2\omega)}{\sqrt{r}}
\end{equation}
where $r$ is the system repetition rate.

\subsection{Oblique vs. normal incidence}\label{sec:obliquevsnormal}

While all of the results presented in this thesis utilized the setup in \cref{fig:setup}, where the incident beam makes a small angle with respect to the sample normal, plenty of groups use a different approach where that angle is set to $0^\circ$.
This has the obvious disadvantage of not specifying all of the tensor elements, since any element $\chi_{ijk}$ with $i, j, k = z$ is not accessible in this geometry.
However, in some cases this can actually be something of an advantage.
For example, sometimes unwanted \gls{shg} contributions (see \cref{sec:manyshgterms}) may be avoided in the normal incidence geometry, assuming the \gls{na} of the focusing optic is small enough that longitudinal components of the electric field are nearly zero.
Furthermore, in some materials the order parameter only couples to one or two elements of $\chi_{ijk}$; if none of these elements have a $z$ index, it is needless to complicate the analysis with oblique incidence.

In my experience, oblique incidence seems to be useful in two broad cases.
For one thing, some order parameters only show up in the $z$ components of $\chi_{ijk}$ (this is the case in \tastwo, see \cref{sec:tastwo}), in which case one obviously needs a nonzero angle of incidence to access these components.
A more subtle point is that, even if in practice all of the phenomenology of a particular sample only shows up in the $x$ and $y$ indices of $\chi_{ijk}$, still one must measure the full tensor to \emph{rule out} unseen phenomenology in the other indices.
Both the \ce{CaMn2Bi2} (\cref{ch:cmb}) and \ce{CuBr2} (\cref{ch:cubr2}) works presented in this thesis are examples of exactly this point, where the main scientific arguments involve either comparing \gls{shg} patterns in two domains or comparing oscillation amplitudes in different polarization channels.
Clearly one needs to know all of the tensor elements to make those arguments exact.

\subsection{Choice of detector}

Our setup is somewhat unique in using a \gls{pmt} for data collection rather than an \gls{emccd}, which is the slightly more traditional method.
Frankly, this decision was not based on the detection efficiency, but rather the fact that \glspl{pmt} typically cost about two orders of magnitude less than \glspl{emccd}.
However, the setup construction with a \gls{pmt} is slightly different than with an \gls{emccd}, so you should probably decide which you want to use before you start building your setup.
With an \gls{emccd}, the beam is sent into the device without focusing (L4 in \cref{fig:setup}) so that the beam traces a circle on the sensor as a function of time\cite{harter_high-speed_2015}.
The rotational anisotropy signal is read off by performing a radial integration of the camera image (after masking the part of the image which is outside from the circle traced by the beam).
In this way, the rotation angle of the motor is correlated with the \gls{shg} signal via the azimuthal degree of freedom on the camera image.
In contrast, with a \gls{pmt} the \gls{shg} signal is read out as a function of time on an oscilloscope (see \cref{sec:setupdescription}), and must be correlated with the rotation angle of the motor by some other method.
We use an optical chopper wheel attached to the motor shaft; a beam from a laser pointer is directed through the chopper wheel and onto a photodiode, which produces a square wave signal that is used to trigger the oscilloscope.
One must also be careful that the \gls{pmt} is aligned as close to normal as possible to the axis defined by DM2 and L4 in \cref{fig:setup}, as the \gls{pmt} output is actually quite sensitive to the angle of incidence of the input radiation.

As for the detection efficiency of the two devies, an \gls{emccd} is basically an \emph{array} of \glspl{pmt} -- thus, there is no fundamental difference in the detection efficiences of the two methods, although having never used an \gls{emccd} I cannot speak to any specific considerations that might favor one over the other.

\section{Time-resolved SHG: methodology}

\subsubsection{Polarization control}

The main limitation for doing \gls{trshg} is simply that the experiment becomes longer.
Each measurement of $\chi_{ijk}$ requires averaging four different polarization channels (\PP, \PS, \SP, and \SS), which, depending on the signal to noise ratio, can take as long as $2-3$ minutes each.
In a time-resolved experiment, that procedure must be repeated at least once for each time delay; in fact, it us often useful to sweep the delay stage multiple times to reduce the extent to which systematic drifts in in the laser power, alignment, etc. affect the time trace.
Not only is this time-consuming (typically taking $\sim 12$ \si{hours} to get a good dataset), but it also requires four rotations of the polarizers at each delay, which is simply not feasible if the polarizers are to be rotated manually.
Unfortunately, automated polarizer rotation is difficult in the \gls{rashg} experimental geometry because the polarizers must be rotated relative to a lens tube which is \emph{itself} rotating at $5$ \si{Hz}.
The traditional method of rotating polarizers via stepper motor is thus not possible, unless one finds a method to transmit power between the stationary laboratory frame and the rotating frame that the polarizer lives in.
Myself and Karna Morey designed such a method using an electronic device known as a hollow-bore electric slip ring, which uses ring-shaped conductive pads in combination with low-friction metallic brushes to conduct electricity between two rotating objects.
In my opinion, such a design is essential to doing \gls{trshg} unless one is satisfied with only measuring a single polarization channel; thus, I have dedicated the entirety of \cref{ch:polrotators} to our solution, which in my opinion represents the largest contribution we made to \gls{shg} methodology during this thesis.

\subsubsection{The pump beam path}

Having discussed the modifications needed for \gls{trshg} on the probe arm, let us now describe the pump beam path.
$100$ \si{fs} pulses from the regenerative amplifier (Spectra-Physics Spitfire Sptf-100f-5k-xp) are split by $90:10$ beamsplitter (with the $10\%$ becoming the probe beam, see \cref{sec:setupdescription}) and are used as input to an \gls{opa} (Light conversion ??) which produces light of variable wavelength between $1100$ and $2080$ \si{nm}.
The output of the \gls{opa} is directed through a wire-grid polarizer (to pick out the signal or idler, as needed) to an optical delay line (Newport DL125 with SMC100 motion controller) and a second polarizer to vary the beam power.
The beam then passes through a \gls{nir} longpass filter to remove unwanted visible wavelengths that are output by the \gls{opa}.
A $400$ \si{nm} lens focuses the beam past two mirrors (one mounted with epoxy onto the focusing lens L3 of \cref{fig:setup}\footnote{Remember that the probe beam is arriving at oblique incidence and thus passes through the edge, rather than the center, of L3.}) and finally onto the sample.
The diameter of the pump beam at the focus is set by moving the lens position along the beampath and monitoring the beam shape with a CCD camera.
The pointing of the beam is aligned so that the light reflected off the sample is perfectly backscattered.
Pump scatter is avoided by mounting a small black circular disk in the center of L3, and by subtracting ``dark'' scans without the probe beam from the final dataset.

An chopper wheel is placed somewhere in the pump beam path which blocks every other pulse from the \gls{opa}, so that the effective repetition rate of the pump pulsetrain is $2.5$ \si{kHz}.
The output of the \gls{pmt} (see \cref{fig:setup}) is sent to a lock-in amplifier synced to this frequency, so that the output of the lock-in is proportional to
\begin{equation}
I^\mathrm{SHG}_{\mathrm{Pump}+\mathrm{Probe}} - I^\mathrm{SHG}_\mathrm{Probe}
\end{equation}
i.e. the output of the lock-in is the pump-induced change in the measured \gls{shg} intensity.

Finally, the pump-probe time delay is varied, and for each delay the rotational anisotropy in the lock-in signal is measured in each of the four polarization channels.
Alternatively, the motor rotation may be parked at a fixed angle and the \gls{shg} intensity at this angle measured as a function of delay time.

\subsection{Detection frequency}

\subsection{Location of pump mirror}

\subsection{Normal incidence of the pump beam}

\subsection{Pump scatter}
